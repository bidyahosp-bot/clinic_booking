<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>حجز مواعيد عيادة الجلدية - مستشفى بدية</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Tahoma, Arial, sans-serif;
  background: #f9f9f9;
  text-align: center;
  direction: rtl;
  color: #333;
}
header {
  background: #006699;
  color: #fff;
  padding: 15px;
  font-size: 20px;
  font-weight: bold;
}
.slot {
  display: inline-block;
  margin: 5px;
  padding: 12px;
  min-width: 75px;
  border-radius: 6px;
  border: 1px solid #ccc;
  background: #fff;
  cursor: pointer;
  font-size: 16px;
}
.slot.booked {
  background: #ddd;
  color: #777;
  cursor: not-allowed;
}
#form {
  display: none;
  max-width: 320px;
  margin: 20px auto;
  background: #fff;
  padding: 15px;
  border-radius: 8px;
  box-shadow: 0 0 8px rgba(0,0,0,0.1);
}
input, button {
  width: 100%;
  padding: 10px;
  margin: 8px 0;
  font-size: 16px;
}
button {
  background: #006699;
  color: #fff;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}
button:hover {
  background: #004466;
}
#message {
  margin-top: 15px;
  font-weight: bold;
}
#message.success { color: green; }
#message.error { color: red; }
#counter {
  margin: 15px 0;
  font-size: 18px;
  font-weight: bold;
  color: #006699;
}
</style>
</head>

<body>

<header>مستشفى بدية</header>
<h2>حجز مواعيد عيادة الجلدية<br>الأربعاء 7 / 1 / 2026</h2>

<p id="counter"></p>
<div id="slots"></div>

<div id="form">
  <h3>أدخل بياناتك</h3>
  <input type="text" id="name" placeholder="الاسم الثلاثي">
  <input type="text" id="civil" placeholder="الرقم المدني">
  <input type="text" id="phone" placeholder="رقم الهاتف">
  <button onclick="submitBooking()">تأكيد الحجز</button>
</div>

<p id="message"></p>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxXM6v1MM-sl8qxi-Pp6bITiiqTKDW5jSJh0aOsaeDcS_BbAI_xsZkMFWeo2IFu3lTTWA/exec";

const slotsDiv = document.getElementById("slots");
const counter = document.getElementById("counter");
const message = document.getElementById("message");
const form = document.getElementById("form");

let slots = [];
let selectedIndex = null;

// إنشاء المواعيد (100 موعد – كل 3 دقائق)
let h = 8, m = 0;
for (let i = 0; i < 100; i++) {
  slots.push({ time: String(h).padStart(2,"0") + ":" + String(m).padStart(2,"0"), booked:false });
  m += 3;
  if (m >= 60) { m = 0; h++; }
}

function renderSlots() {
  slotsDiv.innerHTML = "";
  let available = 0;

  slots.forEach((s, i) => {
    const d = document.createElement("div");
    d.className = "slot" + (s.booked ? " booked" : "");
    d.innerText = s.time;
    if (!s.booked) {
      d.onclick = () => {
        selectedIndex = i;
        form.style.display = "block";
      };
      available++;
    }
    slotsDiv.appendChild(d);
  });

  counter.innerText = `المواعيد المتاحة: ${available} من ${slots.length}`;
  if (available === 0) {
    message.className = "error";
    message.innerText = "تم إغلاق جميع المواعيد ❌";
  }
}

function submitBooking() {
  if (selectedIndex === null) return;

  const name  = document.getElementById("name").value.trim();
  const civil = document.getElementById("civil").value.trim();
  const phone = document.getElementById("phone").value.trim();
  const time  = slots[selectedIndex].time;

  if (!name || !civil || !phone) {
    message.className = "error";
    message.innerText = "❌ الرجاء تعبئة جميع الحقول";
    return;
  }

  const params = new URLSearchParams();
  params.append("name", name);
  params.append("civil", civil);
  params.append("phone", phone);
  params.append("time", time);

  fetch(SCRIPT_URL, {
    method: "POST",
    body: params
  })
  .then(r => r.text())
  .then(t => {
    if (t.includes("❌")) {
      message.className = "error";
      message.innerText = t;
    } else {
      slots[selectedIndex].booked = true;
      renderSlots();
      form.style.display = "none";
      message.className = "success";
      message.innerText = t;
    }
  })
  .catch(() => {
    message.className = "error";
    message.innerText = "تعذر الاتصال بالخادم ❌";
  });
}

// تحميل الحجوزات السابقة
// تحميل الحجوزات السابقة
fetch(SCRIPT_URL)
  .then(r => r.json())
  .then(data => {
    data.forEach(b => {
      const s = slots.find(x => x.time === b.time);
      if (s) s.booked = true;   // ← هنا يتم الإغلاق
    });
    renderSlots();
  })
  .catch(() => renderSlots());

</script>

</body>
</html>

